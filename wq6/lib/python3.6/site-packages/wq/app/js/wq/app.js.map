{"version":3,"file":"app.js","sources":["../../node_modules/@wq/app/src/app.js"],"sourcesContent":["import jQM from '@wq/jquery-mobile';\nimport ds from '@wq/store';\nimport modelModule from '@wq/model';\nimport outbox from '@wq/outbox';\nimport tmpl from '@wq/template';\nimport router from '@wq/router';\nimport spinner from './spinner';\n\nvar app = {\n    OFFLINE: 'offline',\n    FAILURE: 'failure',\n    ERROR: 'error',\n    get wq_config() {\n        return this.getAuthState().config || this.config;\n    },\n    get user() {\n        return this.getAuthState().user;\n    },\n    get csrftoken() {\n        return this.getAuthState().csrftoken;\n    }\n};\n\nconst SERVER = '@@SERVER',\n    LOGIN_SUCCESS = 'LOGIN_SUCCESS',\n    LOGIN_RELOAD = 'LOGIN_RELOAD',\n    CSRFTOKEN = 'CSRFTOKEN',\n    LOGOUT = '@@LOGOUT';\n\napp.models = {};\napp.plugins = {};\n\nvar _register = {},\n    _onShow = {};\n\nvar $, jqm;\n\napp.init = function(config) {\n    app.jQuery = $ = config.jQuery || window.jQuery || jQM();\n    jqm = $.mobile || jQM().mobile;\n    app.use(spinner);\n    app.use(syncRefresh);\n    app.use(showOutboxErrors);\n    router.addContext(() => spinner.start() && {});\n    router.addContext(_getRouteInfo);\n    router.addContext(app.userInfo);\n    router.addContext(_getSyncInfo);\n    router.addThunk(LOGIN_SUCCESS, _refreshUserInfo);\n    router.addThunk(LOGIN_RELOAD, _refreshUserInfo);\n    router.addThunk(LOGOUT, _refreshUserInfo);\n    router.addThunk(CSRFTOKEN, _refreshCSRFToken);\n\n    // Router (wq/router.js) configuration\n    if (!config.router) {\n        config.router = {\n            base_url: ''\n        };\n    }\n    config.router.getTemplateName = getTemplateName;\n\n    // Store (wq/store.js) configuration\n    if (!config.store) {\n        config.store = {\n            service: config.router.base_url,\n            defaults: { format: 'json' }\n        };\n    }\n    if (!config.store.fetchFail) {\n        config.fetchFail = _fetchFail;\n    }\n\n    ds.addReducer('auth', _authReducer, true);\n\n    Object.entries(app.plugins).forEach(([name, plugin]) => {\n        if (plugin.ajax) {\n            config.store.ajax = plugin.ajax;\n        }\n        if (plugin.reducer) {\n            ds.addReducer(name, (state, action) =>\n                plugin.reducer(state, action)\n            );\n        }\n        if (plugin.render) {\n            router.addRender(state => plugin.render(state));\n        }\n        if (plugin.actions) {\n            Object.assign(plugin, ds.bindActionCreators(plugin.actions));\n        }\n        if (plugin.thunks) {\n            router.addThunks(plugin.thunks);\n        }\n    });\n\n    app.spin = {\n        start: (msg, duration, opts) => spinner.start(msg, duration, opts),\n        forSeconds: duration => spinner.start(null, duration),\n        stop: () => spinner.stop()\n    };\n\n    // Outbox (wq/outbox.js) configuration\n    if (!config.outbox) {\n        config.outbox = {};\n    }\n\n    // Propagate debug setting to other modules\n    if (config.debug) {\n        config.router.debug = config.debug;\n        config.store.debug = config.debug;\n        config.template.debug = config.debug;\n    }\n\n    // Copy jQuery to plugins (in case not set globally)\n    ['router', 'template'].concat(Object.keys(app.plugins)).forEach(key => {\n        if (!config[key]) {\n            config[key] = {};\n        }\n        config[key].jQuery = $;\n    });\n\n    // Load missing (non-local) content as JSON, or as server-rendered HTML?\n    // Default (as of 1.0) is to load JSON and render on client.\n    config.loadMissingAsJson =\n        config.loadMissingAsJson || !config.loadMissingAsHtml;\n    config.loadMissingAsHtml = !config.loadMissingAsJson;\n\n    // After a form submission, sync in the background, or wait before\n    // continuing?  Default is to sync in the background.\n    if (config.backgroundSync === undefined) {\n        config.backgroundSync = true;\n    }\n\n    app.config = config;\n\n    app['native'] = !!window.cordova;\n    app.can_login = !!config.pages.login;\n\n    // Initialize wq/router.js\n    router.init(config.router);\n    app.base_url = router.base_url;\n\n    app.store = ds;\n    app.outbox = outbox;\n    outbox.app = app;\n    app.router = router;\n\n    // Initialize wq/template.js\n    tmpl.init(config.template);\n\n    // Option to submit forms in the background rather than wait for each post\n    if (config.backgroundSync) {\n        if (config.backgroundSync === -1) {\n            outbox.pause();\n        } else if (config.backgroundSync > 1) {\n            console.warn('Sync interval is now controlled by redux-offline');\n        }\n    }\n\n    // Deprecated hooks\n    const deprecated = {\n        noBackgroundSync: 'backgroundSync: false',\n        postsave: 'a postsaveurl() plugin hook or a postsave page config',\n        saveerror: 'an onsync() plugin hook',\n        showOutboxErrors: 'an onsync() and/or run() hook',\n        _addOutboxItemsToContext: \"@wq/outbox's IMMEDIATE mode\",\n        presync: 'the template context',\n        postsync: 'the template context or an onsync() plugin hook'\n    };\n    Object.entries(deprecated).forEach(([hook, alternative]) => {\n        // TODO: Make this an error in 2.0\n        if (config[hook]) {\n            console.warn(\n                new Error(\n                    `config.${hook} has no effect.  Use ${alternative} instead.  See wq.app 1.2 release notes for more info.`\n                )\n            );\n        }\n    });\n    if (app.hasPlugin('onsave')) {\n        console.warn(\n            new Error(\n                'An onsave() plugin hook has no effect.  Use an onsync() hook instead.  See wq.app 1.2 release notes for more info.'\n            )\n        );\n    }\n\n    // Configure jQuery Mobile transitions\n    if (config.transitions) {\n        var def = 'default';\n        if (config.transitions[def]) {\n            jqm.defaultPageTransition = config.transitions[def];\n        }\n        if (config.transitions.dialog) {\n            jqm.defaultDialogTransition = config.transitions.dialog;\n        }\n        jqm.maxTransitionWidth = config.transitions.maxwidth || 800;\n    }\n\n    Object.keys(app.config.pages).forEach(function(page) {\n        app.config.pages[page].name = page;\n    });\n\n    app.callPlugins('init');\n\n    // Register routes with wq/router.js\n    var root = false;\n    Object.keys(app.config.pages).forEach(function(page) {\n        var conf = _getBaseConf(page);\n        if (!conf.url) {\n            root = true;\n        }\n        if (conf.list) {\n            conf.modes.forEach(function(mode) {\n                var register = _register[mode] || _register.detail;\n                var onShow = _onShow[mode] || _onShow.detail;\n                register(page, mode);\n                onShow(page, mode);\n            });\n            (conf.server_modes || []).forEach(function(mode) {\n                _register.detail(page, mode, _serverContext);\n                var onShow = _onShow[mode] || _onShow.detail;\n                onShow(page, mode);\n            });\n            app.models[page] = modelModule(conf);\n        } else if (conf) {\n            _registerOther(page);\n            _onShowOther(page);\n        }\n    });\n\n    // Register outbox\n    router.register('outbox', 'outbox', () => outbox.loadItems());\n    router.onShow('outbox', app.runPlugins);\n    router.register('outbox/<slug>', 'outbox_detail', _renderOutboxItem);\n    router.register('outbox/<slug>/edit', 'outbox_edit', _renderOutboxItem);\n    router.onShow('outbox_detail', app.runPlugins);\n    router.onShow('outbox_edit', app.runPlugins);\n\n    // Fallback index page\n    if (!root && !app.config.pages.index && config.template.templates.index) {\n        router.registerLast('', 'index', function(ctx) {\n            var context = {};\n            context.pages = Object.keys(app.config.pages).map(function(page) {\n                var conf = app.config.pages[page];\n                return {\n                    name: page,\n                    url: conf.url,\n                    list: conf.list\n                };\n            });\n            return context;\n        });\n    }\n\n    // Fallback for all other URLs\n    router.registerLast(':path*', SERVER, _serverContext);\n\n    // Handle form events\n    $(document).on('submit', 'form', _handleForm);\n    $(document).on('click', 'form [type=submit]', _submitClick);\n\n    Object.entries(app.plugins).forEach(([name, plugin]) => {\n        if (plugin.context) {\n            router.addContext(ctx => {\n                return plugin.context(ctx, ctx.router_info);\n            });\n        }\n    });\n\n    router.addContext(() => spinner.stop() && {});\n\n    // Initialize wq/store.js and wq/outbox.js\n    ds.init(config.store);\n    app.service = ds.service;\n\n    var ready = ds.ready.then(() => outbox.init(config.outbox));\n\n    if (app.can_login) {\n        // Initialize authentication, if applicable\n        router.register('logout', 'logout', app.logout);\n        ready = ready\n            .then(() => {\n                app.outbox.setCSRFToken(app.csrftoken);\n            })\n            .then(_checkLogin);\n    }\n\n    if (app.config.jqmInit) {\n        ready = ready.then(app.jqmInit);\n    }\n\n    return ready;\n};\n\nvar pcount = 0;\napp.use = function(plugin) {\n    pcount++;\n    if (!plugin.name) {\n        plugin.name = 'plugin' + pcount;\n    }\n    app.plugins[plugin.name] = plugin;\n    plugin.app = app;\n};\n\napp.prefetchAll = function() {\n    return Promise.all(\n        Object.keys(app.models).map(function(name) {\n            return app.models[name].prefetch();\n        })\n    );\n};\n\napp.jqmInit = router.jqmInit;\n\napp.logout = function() {\n    if (!app.can_login || !app.user) {\n        return;\n    }\n\n    ds.dispatch({\n        type: LOGOUT\n    });\n\n    // Notify server (don't need to wait for this)\n    ds.fetch('/logout').then(function(result) {\n        ds.dispatch({\n            type: CSRFTOKEN,\n            payload: result\n        });\n    });\n};\n\napp.userInfo = function() {\n    return {\n        user: app.user,\n        is_authenticated: !!app.user,\n        app_config: app.config,\n        wq_config: app.wq_config,\n        csrf_token: app.csrftoken\n    };\n};\n\nasync function _refreshUserInfo(dispatch, getState) {\n    await _refreshCSRFToken();\n    var context = getState().context || {};\n    router.render(\n        {\n            ...context,\n            ...app.userInfo()\n        },\n        true\n    );\n    // FIXME: Better way to do this?\n    app.spin.start();\n    await app.prefetchAll();\n    app.spin.stop();\n    await router.reload();\n}\nasync function _refreshCSRFToken() {\n    outbox.setCSRFToken(app.csrftoken);\n}\n\nasync function _getSyncInfo() {\n    const unsynced = await outbox.unsynced();\n    return {\n        syncing: app.syncing,\n        unsynced: unsynced\n    };\n}\n\napp.go = function() {\n    throw new Error('app.go() has been removed.  Use app.nav() instead');\n};\n\n// Run any/all plugins on the specified page\napp.runPlugins = function(arg) {\n    if (arg) {\n        throw new Error('runPlugins() now loads args from context');\n    }\n    const state = router.store.getState(),\n        { context } = state;\n\n    var { router_info: routeInfo } = context;\n\n    var getItem;\n\n    if (context.outbox_id) {\n        getItem = Promise.resolve(context);\n    } else if (routeInfo.item_id) {\n        if (context.local) {\n            getItem = Promise.resolve(context);\n        } else {\n            getItem = app.models[routeInfo.page].find(routeInfo.item_id);\n        }\n    } else {\n        getItem = Promise.resolve({});\n    }\n    getItem.then(function(item) {\n        routeInfo = {\n            ...routeInfo,\n            item,\n            context\n        };\n        if (window.MSApp && window.MSApp.execUnsafeLocalFunction) {\n            window.MSApp.execUnsafeLocalFunction(function() {\n                app.callPlugins('run', [jqm.activePage, routeInfo]);\n            });\n        } else {\n            app.callPlugins('run', [jqm.activePage, routeInfo]);\n        }\n    });\n};\n\n// Sync outbox and handle result\napp.sync = function(retryAll) {\n    if (retryAll) {\n        console.warn('app.sync(true) renamed to app.retryAll()');\n        app.retryAll();\n    } else {\n        throw new Error('app.sync() no longer used.');\n    }\n};\napp.retryAll = function() {\n    app.outbox.unsynced().then(function(unsynced) {\n        if (!unsynced) {\n            return;\n        }\n        app.outbox.retryAll();\n    });\n};\n\napp.emptyOutbox = function(confirmFirst) {\n    /* global confirm */\n    if (confirmFirst) {\n        if (navigator.notification && navigator.notification.confirm) {\n            navigator.notification.confirm('Empty Outbox?', function(button) {\n                if (button == 1) {\n                    app.emptyOutbox();\n                }\n            });\n            return;\n        } else {\n            if (!confirm('Empty Outbox?')) {\n                return;\n            }\n        }\n    }\n    return outbox.empty();\n};\n\napp.confirmSubmit = function(form, message) {\n    /* global confirm */\n    var $form;\n    if (navigator.notification && navigator.notification.confirm) {\n        $form = $(form);\n        if ($form.data('wq-confirm-submit')) {\n            return true;\n        }\n        navigator.notification.confirm(message, function(button) {\n            if (button == 1) {\n                $form.data('wq-confirm-submit', true);\n                $form.trigger('submit');\n            }\n        });\n    } else {\n        if (confirm(message)) {\n            return true;\n        }\n    }\n    return false;\n};\n\n// Handle navigation after form submission\napp.postSaveNav = function(item, alreadySynced) {\n    var url;\n\n    const pluginUrl = app\n        .callPlugins('postsaveurl', [item, alreadySynced])\n        .filter(item => !!item);\n\n    if (pluginUrl.length) {\n        url = pluginUrl[0];\n    } else {\n        url = app.postsaveurl(item, alreadySynced);\n    }\n\n    // Navigate to computed URL\n    if (app.config.debug) {\n        console.log('Successfully saved; continuing to ' + url);\n    }\n    router.push(url);\n};\n\napp.postsaveurl = function(item, alreadySynced) {\n    var postsave, pconf, match, mode, url, itemid, modelConf;\n\n    // conf.postsave can be set redirect to another page\n    modelConf = item.options.modelConf;\n    if (item.deletedId) {\n        postsave = modelConf.postdelete;\n    } else {\n        postsave = modelConf.postsave;\n    }\n    if (!postsave) {\n        // Otherwise, default is to return the page for the item just saved\n        if (!alreadySynced || item.deletedId) {\n            // If backgroundSync, return to list view while syncing\n            postsave = modelConf.name + '_list';\n        } else {\n            // If !backgroundSync, return to the newly synced item\n            postsave = modelConf.name + '_detail';\n        }\n    }\n\n    // conf.postsave should explicitly indicate which template mode to use\n    /* eslint no-useless-escape: off */\n    match = postsave.match(/^([^\\/]+)_([^_\\/]+)$/);\n    if (match) {\n        postsave = match[1];\n        mode = match[2];\n    }\n\n    // Retrieve configuration for postsave page, if any\n    pconf = _getConf(postsave, true);\n\n    // Compute URL\n    if (!pconf) {\n        // If conf.postsave is not the name of a list page, assume it's a\n        // simple page or a URL\n        var urlContext;\n        if (item.deletedId) {\n            urlContext = { deleted: true, ...router.store.getState().context };\n        } else {\n            urlContext = { ...item.data, ...item.result };\n        }\n        url = app.base_url + '/' + tmpl.render(postsave, urlContext);\n    } else if (!pconf.list) {\n        url = app.base_url + '/' + pconf.url;\n    } else {\n        if (pconf.modes.indexOf(mode) == -1) {\n            throw 'Unknown template mode!';\n        }\n\n        // For list pages, the url can differ depending on the mode\n        url = app.base_url + '/' + pconf.url + '/';\n\n        if (mode != 'list') {\n            // Detail or edit view; determine item id and add to url\n            if (postsave == modelConf.name && !item.synced) {\n                // Config indicates return to detail/edit view of the model\n                // that was just saved, but the item hasn't been synced yet.\n                // Navigate to outbox URL instead.\n                url = app.base_url + '/outbox/' + item.id;\n                if (mode != 'edit' && item.error) {\n                    // Return to edit form if there was an error\n                    mode = 'edit';\n                }\n            } else {\n                // Item has been successfully synced\n                if (postsave == modelConf.name) {\n                    // If postsave page is the same as the item's page, use the\n                    // new id\n                    itemid = item.result && item.result.id;\n                } else {\n                    // Otherwise, look for a foreign key reference\n                    // FIXME: what if the foreign key has a different name?\n                    itemid = item.result && item.result[postsave + '_id'];\n                }\n                if (!itemid) {\n                    throw 'Could not find ' + postsave + ' id in result!';\n                }\n                url += itemid;\n            }\n            if (mode != 'detail') {\n                url += '/' + mode;\n            }\n        }\n    }\n    return url;\n};\n\n// Hook for handling navigation / alerts after a submission error\n// (only used when !backgroundSync)\napp.saveerror = function(item, reason, $form) {\n    // Save failed for some reason, perhaps due to being offline\n    // (override to customize behavior, e.g. display an outbox)\n    if (app.config.debug) {\n        console.warn('Could not save: ' + reason);\n    }\n    if (reason == app.OFFLINE) {\n        app.postSaveNav(item, false);\n    } else {\n        app.showOutboxErrors(item, $form);\n    }\n};\n\nconst syncRefresh = {\n    onsync(obitem) {\n        const { context } = this.app.store.getState(),\n            { router_info: routeInfo } = context,\n            { full_path, item_id, parent_id } = routeInfo,\n            { id: outboxId, result } = obitem || {},\n            { id: resultId } = result || {},\n            outboxSlug = `outbox-${outboxId}`;\n\n        if (resultId && (item_id === outboxSlug || parent_id === outboxSlug)) {\n            router.push(full_path.replace(outboxSlug, resultId));\n        } else if (jqm.activePage.data('wq-sync-refresh')) {\n            router.reload();\n        }\n    }\n};\n\n// Return a list of all foreign key fields\napp.getParents = function(page) {\n    var conf = _getBaseConf(page);\n    return conf.form\n        .filter(function(field) {\n            return field['wq:ForeignKey'];\n        })\n        .map(function(field) {\n            return field['wq:ForeignKey'];\n        });\n};\n\n// Shortcuts for $.mobile.changePage\napp.nav = function(url) {\n    url = app.base_url + '/' + url;\n    router.push(url);\n};\n\napp.replaceState = function(url) {\n    throw new Error('app.replaceState() no longer supported.');\n};\n\napp.refresh = function() {\n    router.refresh();\n};\n\napp.hasPlugin = function(method) {\n    var plugin,\n        fn,\n        hasPlugin = false;\n    for (plugin in app.plugins) {\n        fn = app.plugins[plugin][method];\n        if (fn) {\n            hasPlugin = true;\n        }\n    }\n    return hasPlugin;\n};\n\napp.callPlugins = function(method, args) {\n    var plugin,\n        fn,\n        fnArgs,\n        queue = [];\n    for (plugin in app.plugins) {\n        fn = app.plugins[plugin][method];\n        if (args) {\n            fnArgs = args;\n        } else {\n            fnArgs = [app.config[plugin]];\n        }\n        if (fn) {\n            queue.push(fn.apply(app.plugins[plugin], fnArgs));\n        }\n    }\n    return queue;\n};\n\n// Internal variables and functions\nfunction _splitRoute(routeName) {\n    const match = routeName.match(/^(.+)_([^_]+)$/);\n    let page, mode, variant;\n    if (match) {\n        page = match[1];\n        mode = match[2];\n        if (mode.indexOf(':') > -1) {\n            [mode, variant] = mode.split(':');\n        } else {\n            variant = null;\n        }\n    } else {\n        page = routeName;\n        mode = null;\n        variant = null;\n    }\n    return [page, mode, variant];\n}\n\nfunction _joinRoute(page, mode, variant) {\n    if (variant) {\n        return page + '_' + mode + ':' + variant;\n    } else if (mode) {\n        return page + '_' + mode;\n    } else {\n        return page;\n    }\n}\n\nfunction _getRouteInfo(ctx, arg) {\n    if (arg) {\n        throw new Error('_getRouteInfo() now auto-created from context');\n    }\n    const { router_info: routeInfo } = ctx,\n        routeName = routeInfo.name,\n        itemid = routeInfo.slugs.slug || null;\n    var [page, mode, variant] = _splitRoute(routeName),\n        conf = _getConf(page, true),\n        pageid = null;\n\n    if (conf) {\n        if (mode && mode !== 'list') {\n            pageid =\n                page +\n                '_' +\n                mode +\n                (variant ? '_' + variant : '') +\n                (itemid ? '_' + itemid : '') +\n                '-page';\n        }\n    } else {\n        page = routeName;\n        mode = null;\n        conf = {\n            name: page,\n            page: page,\n            form: [],\n            modes: []\n        };\n    }\n    return {\n        svc: app.service,\n        native: app['native'],\n        page_config: conf,\n        router_info: {\n            ...routeInfo,\n            page: page,\n            page_config: conf,\n            mode: mode,\n            variant: variant,\n            item_id: itemid,\n            dom_id: pageid\n        }\n    };\n}\n\nfunction getTemplateName(name, context) {\n    if (context.template) {\n        return context.template;\n    } else {\n        return name.split(':')[0];\n    }\n}\n\n// Generate list view context and render with [url]_list template;\n// handles requests for [url] and [url]/\n_register.list = function(page) {\n    const conf = _getBaseConf(page),\n        register = conf.url === '' ? router.registerLast : router.register;\n    register(conf.url, _joinRoute(page, 'list'), ctx => _displayList(ctx));\n\n    // Special handling for /[parent_list_url]/[parent_id]/[url]\n    app.getParents(page).forEach(function(ppage) {\n        var pconf = _getBaseConf(ppage);\n        var url = pconf.url;\n        var registerParent;\n        if (url === '') {\n            registerParent = router.registerLast;\n        } else {\n            registerParent = router.register;\n            url += '/';\n        }\n        url += ':parent_id/' + conf.url;\n        registerParent(url, _joinRoute(page, 'list', ppage), parentContext);\n    });\n\n    async function parentContext(ctx) {\n        const { router_info: routeInfo } = ctx,\n            { page, variant: ppage } = routeInfo,\n            parent_id = routeInfo.slugs.parent_id,\n            pconf = _getConf(ppage),\n            pitem = await app.models[ppage].find(parent_id);\n        var parentUrl;\n        if (pitem) {\n            parentUrl = pconf.url + '/' + pitem.id;\n        } else if (parent_id.indexOf('outbox-') == -1) {\n            parentUrl = 'outbox/' + parent_id.split('-')[1];\n        } else {\n            parentUrl = null;\n        }\n        var info = {\n            parent_id,\n            parent_url: parentUrl,\n            parent_label: pitem && pitem.label,\n            parent_page: ppage,\n            router_info: {\n                ...routeInfo,\n                parent_id,\n                parent_page: ppage,\n                parent_url: parentUrl\n            }\n        };\n        info['parent_is_' + ppage] = true;\n        return _displayList(ctx, info);\n    }\n};\n\n_onShow.list = function(page) {\n    router.onShow(_joinRoute(page, 'list'), app.runPlugins);\n\n    // Special handling for /[parent_list_url]/[parent_id]/[url]\n    app.getParents(page).forEach(function(ppage) {\n        router.onShow(_joinRoute(page, 'list', ppage), app.runPlugins);\n    });\n};\n\napp._addOutboxItemsToContext = function(context, unsyncedItems) {\n    // Add any outbox items to context\n    context.unsynced = unsyncedItems.length;\n    context.unsyncedItems = unsyncedItems;\n};\n\nasync function _displayList(ctx, parentInfo) {\n    const { router_info: routeInfo } = ctx,\n        { page, params, full_path: url } = routeInfo,\n        conf = _getConf(page),\n        model = app.models[page];\n    var pnum = model.opts.page,\n        next = null,\n        prev = null,\n        filter;\n    if (params || parentInfo) {\n        if (params && params.page) {\n            pnum = params.page;\n        }\n        filter = {};\n        for (var key in params || {}) {\n            if (key != 'page') {\n                filter[key] = params[key];\n            }\n        }\n        if (parentInfo) {\n            conf.form.forEach(function(field) {\n                if (field['wq:ForeignKey'] == parentInfo.parent_page) {\n                    filter[field.name + '_id'] = parentInfo.parent_id;\n                }\n            });\n        }\n    }\n    if (filter && !Object.keys(filter).length) {\n        filter = null;\n    }\n\n    // Load from server if data might not exist locally\n    if (app.config.loadMissingAsHtml) {\n        if (!model.opts.client) {\n            return _loadFromServer(url);\n        }\n        if (filter && model.opts.server) {\n            return _loadFromServer(url);\n        }\n        if (pnum > model.opts.page) {\n            return _loadFromServer(url);\n        }\n    } else if (filter && pnum > model.opts.page) {\n        filter.page = pnum;\n    }\n\n    if (!pnum && (!model.opts.client || filter)) {\n        pnum = 1;\n    }\n\n    function getData() {\n        if (filter) {\n            return model.filterPage(filter);\n        } else if (pnum > model.opts.page) {\n            return model.page(pnum);\n        } else {\n            return model.load();\n        }\n    }\n    async function getUnsynced() {\n        if (pnum == model.opts.page || (pnum == 1 && !model.opts.client)) {\n            return model.unsyncedItems();\n        } else {\n            return [];\n        }\n    }\n\n    // If the number of unsynced records changes while loading the data,\n    // load the data a second time to make sure the list is up to date.\n    // (this is rare except for cache=none lists with background sync)\n    const unsynced1 = await getUnsynced();\n    const data1 = await getData();\n    const unsynced2 = await getUnsynced();\n    var data;\n    if (unsynced1 && unsynced2 && unsynced1.length != unsynced2.length) {\n        data = await getData();\n    } else {\n        data = data1;\n    }\n    const unsyncedItems = unsynced2;\n    var prevIsLocal, currentIsLocal;\n\n    if (pnum > model.opts.page && (model.opts.client || pnum > 1)) {\n        if (+pnum - 1 > model.opts.page && (model.opts.client || pnum > 2)) {\n            let prevp = filter ? { ...filter } : {};\n            prevp.page = +pnum - 1;\n            prev = conf.url + '/?' + $.param(prevp);\n        } else if (pnum == 1 && !filter) {\n            prev = conf.url + '/';\n            prevIsLocal = true;\n        }\n    }\n\n    if (pnum < data.pages && (model.opts.server || pnum)) {\n        let nextp = filter ? { ...filter } : {};\n        nextp.page = +pnum + 1;\n        next = conf.url + '/?' + $.param(nextp);\n        if (nextp.page == 1) {\n            currentIsLocal = true;\n        }\n    }\n\n    var context = {\n        ...data,\n        ...parentInfo,\n        previous: prev ? '/' + prev : null,\n        next: next ? '/' + next : null,\n        multiple: prev || next ? true : false,\n        previous_is_local: prevIsLocal,\n        current_is_local: currentIsLocal\n    };\n\n    app._addOutboxItemsToContext(context, unsyncedItems);\n\n    return _addLookups(page, context, false);\n}\n\n// Generate item detail view context and render with [url]_detail template;\n// handles requests for [url]/[id]\n_register.detail = function(page, mode, contextFn = _displayItem) {\n    var conf = _getBaseConf(page);\n    var url = _getDetailUrl(conf.url, mode);\n    const register = conf.url === '' ? router.registerLast : router.register;\n    register(url, _joinRoute(page, mode), contextFn);\n};\n\n// Register an onshow event for item detail views\n_onShow.detail = function(page, mode) {\n    router.onShow(_joinRoute(page, mode), app.runPlugins);\n};\n\nfunction _getDetailUrl(url, mode) {\n    if (url) {\n        url += '/';\n    }\n    url += '<slug>';\n    if (mode != 'detail') {\n        url += '/' + mode;\n    }\n    return url;\n}\n\n// Generate item edit context and render with [url]_edit template;\n// handles requests for [url]/[id]/edit and [url]/new\n_register.edit = function(page) {\n    var conf = _getBaseConf(page);\n    const register = conf.url === '' ? router.registerLast : router.register;\n    register(\n        _getDetailUrl(conf.url, 'edit'),\n        _joinRoute(page, 'edit'),\n        _displayItem\n    );\n    router.registerFirst(\n        conf.url + '/new',\n        _joinRoute(page, 'edit', 'new'),\n        _displayItem\n    );\n};\n\n// Register an onshow event for item edit views\n_onShow.edit = function(page) {\n    router.onShow(_joinRoute(page, 'edit'), app.runPlugins);\n    router.onShow(_joinRoute(page, 'edit', 'new'), app.runPlugins);\n};\n\nasync function _displayItem(ctx) {\n    const { router_info: routeInfo } = ctx,\n        { item_id: itemid, page, mode, variant, full_path: url } = routeInfo,\n        conf = _getConf(page),\n        model = app.models[page];\n\n    var item;\n    if (mode == 'edit' && variant == 'new') {\n        item = {\n            ...routeInfo.params,\n            ...conf.defaults\n        };\n    } else {\n        const localOnly = !app.config.loadMissingAsJson;\n        item = await model.find(itemid, localOnly);\n        if (!item) {\n            if (model.opts.server && app.config.loadMissingAsHtml) {\n                return _loadFromServer(url);\n            } else {\n                return router.notFound();\n            }\n        }\n    }\n\n    if (item) {\n        item.local = true;\n        if (mode == 'edit') {\n            if (variant == 'new') {\n                // Create new item\n                return _addLookups(page, item, 'new');\n            } else {\n                return _addLookups(page, item, true);\n            }\n        } else {\n            return _addLookups(page, item, false);\n        }\n    } else {\n        if (model.opts.server && app.config.loadMissingAsHtml) {\n            // opts.server indicates that the local list does not represent\n            // the entire dataset; if an item is not found, attempt to load\n            // HTML directly from the server (using built-in jQM loader)\n            return _loadFromServer(url);\n        } else {\n            // If opts.server is false, locally stored list is assumed to\n            // contain the entire dataset, so the item probably does not exist.\n            return router.notFound();\n        }\n    }\n}\n\n// Render non-list pages with with [url] template;\n// handles requests for [url] and [url]/\nfunction _registerOther(page) {\n    var conf = _getBaseConf(page);\n    router.register(conf.url, page, _displayOther);\n    async function _displayOther() {\n        if (conf.server_only) {\n            return _loadFromServer(app.base_url + '/' + conf.url);\n        } else {\n            return {};\n        }\n    }\n}\n\n// Register an onshow event for non-list single pages\nfunction _onShowOther(page) {\n    router.onShow(page, app.runPlugins);\n}\n\nasync function _renderOutboxItem(ctx) {\n    // Display outbox item using model-specific detail/edit view\n    const { router_info: routeInfo } = ctx,\n        mode = routeInfo.page.replace(/^outbox_/, ''),\n        item = await outbox.loadItem(+routeInfo.slugs.slug);\n\n    if (!item || !item.options || !item.options.modelConf) {\n        return router.notFound();\n    }\n\n    var id,\n        page = item.options.modelConf.name,\n        template = page + '_' + mode,\n        idMatch = item.options.url.match(\n            new RegExp(item.options.modelConf.url + '/([^/]+)$')\n        );\n    if (item.data.id) {\n        id = item.data.id;\n    } else if (idMatch) {\n        id = idMatch[1];\n    } else {\n        id = 'new';\n    }\n    var context = {\n        outbox_id: item.id,\n        template: template,\n        error: item.error,\n        router_info: {\n            ...routeInfo,\n            outbox_id: item.id\n        },\n        ...item.data\n    };\n    if (id != 'new') {\n        context.id = id;\n    }\n    return _addLookups(page, context, false);\n}\n\n// Handle form submit from [url]_edit views\nasync function _handleForm(evt) {\n    var $form = $(this),\n        $submitVal,\n        backgroundSync,\n        storage;\n    if (evt.isDefaultPrevented()) {\n        return;\n    }\n    $form.find('[type=submit]').prop('disabled', true);\n    if ($form.data('wq-submit-button-name')) {\n        $submitVal = $('<input>')\n            .attr('name', $form.data('wq-submit-button-name'))\n            .attr('value', $form.data('wq-submit-button-value'));\n        $form.append($submitVal);\n    }\n    if ($form.data('wq-json') !== undefined && !$form.data('wq-json')) {\n        app.spin.forSeconds(10);\n        return; // Defer to default (HTML-based) handler\n    }\n\n    if ($form.data('wq-background-sync') !== undefined) {\n        backgroundSync = $form.data('wq-background-sync');\n    } else {\n        backgroundSync = app.config.backgroundSync;\n    }\n\n    if ($form.data('wq-storage') !== undefined) {\n        storage = $form.data('wq-storage');\n    }\n\n    var outboxId = $form.data('wq-outbox-id');\n    var preserve = $form.data('wq-outbox-preserve');\n    var url = $form.attr('action').replace(app.service + '/', '');\n    var conf = _getConfByUrl(url, true);\n    var vals = {};\n    var $files = $form.find('input[type=file]');\n    var has_files = false;\n    $files.each(function(i, input) {\n        if ($(input).val().length > 0) {\n            has_files = true;\n        }\n    });\n\n    if (!conf) {\n        // Unrecognized URL; assume a regular form post\n        app.spin.forSeconds(10);\n        return;\n    }\n    if (has_files && !window.Blob) {\n        // Files present but there's no Blob API.  Looks like we're in a an old\n        // browser that can't upload files via AJAX.  Bypass wq/outbox.js\n        // entirely and hope server is able to respond to regular form posts\n        // with HTML (hint: wq.db is).\n        app.spin.forSeconds(10);\n        return;\n    }\n\n    // Modern browser and/or no files present; skip regular form submission,\n    // we're saving this via wq/outbox.js\n    evt.preventDefault();\n\n    // Use a simple JSON structure for values, which is better for outbox\n    // serialization.\n    function addVal(name, val) {\n        if (vals[name] !== undefined) {\n            if (!$.isArray(vals[name])) {\n                vals[name] = [vals[name]];\n            }\n            vals[name].push(val);\n        } else {\n            vals[name] = val;\n        }\n    }\n    $.each($form.serializeArray(), function(i, v) {\n        addVal(v.name, v.value);\n    });\n    // Handle <input type=file>.  Use HTML JSON form-style objects, but\n    // with Blob instead of base64 encoding to represent the actual file.\n    if (has_files) {\n        $files.each(function() {\n            var name = this.name,\n                file,\n                slice;\n            if (!this.files || !this.files.length) {\n                return;\n            }\n            for (var i = 0; i < this.files.length; i++) {\n                file = this.files[i];\n                slice = file.slice || file.webkitSlice;\n                addVal(name, {\n                    type: file.type,\n                    name: file.name,\n                    // Convert to blob for better serialization\n                    body: slice.call(file, 0, file.size, file.type)\n                });\n            }\n        });\n    }\n    // Handle blob-stored files created by (e.g.) wq/photos.js\n    $form.find('input[data-wq-type=file]').each(function() {\n        // wq/photo.js files in memory, copy over to form\n        var name = this.name;\n        var value = this.value;\n        var curVal = $.isArray(vals[name]) ? vals[name][0] : vals[name];\n        var photos = app.plugins.photos;\n        if (curVal && typeof curVal === 'string') {\n            delete vals[name];\n        }\n        if (!value || !photos) {\n            return;\n        }\n\n        var data = photos._files[value];\n        if (data) {\n            has_files = true;\n            addVal(name, data);\n            delete photos._files[value];\n        }\n    });\n\n    if ($submitVal) {\n        $submitVal.remove();\n    }\n\n    var options = {\n        url: url\n    };\n\n    if (storage) {\n        options.storage = storage;\n    } else if (!backgroundSync) {\n        options.storage = 'temporary';\n    } else if (has_files) {\n        options.storage = 'store';\n    }\n\n    if (outboxId) {\n        options.id = outboxId;\n        if (preserve && preserve.split) {\n            options.preserve = preserve.split(/,/);\n        }\n    }\n    if (vals._method) {\n        options.method = vals._method;\n        delete vals._method;\n    } else {\n        options.method = 'POST';\n    }\n\n    options.modelConf = conf;\n\n    if (conf.label_template) {\n        options.label = tmpl.render(conf.label_template, vals);\n    }\n\n    $form.find('.error').html('');\n    options.csrftoken = app.csrftoken;\n    var item = await outbox.save(vals, options);\n    if (backgroundSync) {\n        // Send user to next screen while app syncs in background\n        app.postSaveNav(item, false);\n        return;\n    }\n\n    // Submit form immediately and wait for server to respond\n    $form.attr('data-wq-outbox-id', item.id);\n    app.spin.start();\n    item = await outbox.waitForItem(item.id);\n    $form.find('[type=submit]').prop('disabled', false);\n    app.spin.stop();\n    if (!item) {\n        return;\n    }\n    if (item.synced) {\n        // Item was synced\n        app.postSaveNav(item, true);\n        return;\n    }\n    // Something went wrong\n    var error;\n    if (!item.error) {\n        // Save failed without server error: probably offline\n        // FIXME: waitForItem() probably doesn't resolve until back online.\n        error = app.OFFLINE;\n    } else if (typeof item.error === 'string') {\n        // Save failed and error information is not in JSON format\n        // (likely a 500 server failure)\n        error = app.FAILURE;\n    } else {\n        // Save failed and error information is in JSON format\n        // (likely a 400 bad data error)\n        error = app.ERROR;\n    }\n    app.saveerror(item, error, $form);\n}\n\nconst showOutboxErrors = {\n    async run($page, routeInfo) {\n        const { name, outbox_id } = routeInfo;\n        if (name === 'outbox_edit') {\n            const item = await outbox.loadItem(routeInfo.outbox_id);\n            if (item.error) {\n                app.showOutboxErrors(item, $page);\n            }\n        }\n    }\n};\n\napp.showOutboxErrors = function(item, $page) {\n    if ($page.is('form') && item.options.method == 'DELETE') {\n        if (!$page.find('.error').length) {\n            // Delete form does not contain error placeholders\n            // but main form might\n            $page = $page.parents('.ui-page');\n        }\n    }\n    if (!item.error) {\n        showError('Error saving data.');\n        return;\n    } else if (typeof item.error === 'string') {\n        showError(item.error);\n        return;\n    }\n    // Save failed and error information is in JSON format\n    // (likely a 400 bad data error)\n    var errs = Object.keys(item.error);\n\n    if (errs.length == 1 && errs[0] == 'detail') {\n        // General API errors have a single \"detail\" attribute\n        showError(item.error.detail);\n    } else {\n        // REST API provided per-field error information\n\n        // Form errors (other than non_field_errors) are keyed by fieldname\n        errs.forEach(function(f) {\n            // FIXME: there may be multiple errors per field\n            var err = item.error[f][0];\n            if (f == 'non_field_errors') {\n                showError(err);\n            } else {\n                if (typeof err !== 'object') {\n                    showError(err, f);\n                } else {\n                    // Nested object errors (e.g. attachment)\n                    item.error[f].forEach(function(err, i) {\n                        for (var n in err) {\n                            var fid = f + '-' + i + '-' + n;\n                            showError(err[n][0], fid);\n                        }\n                    });\n                }\n            }\n        });\n        if (!item.error.non_field_errors) {\n            showError('One or more errors were found.');\n        }\n    }\n\n    function showError(err, field) {\n        if (field) {\n            field = field + '-';\n        } else {\n            field = '';\n        }\n        var sel = '.' + item.options.modelConf.name + '-' + field + 'errors';\n        $page.find(sel).html(err);\n    }\n};\n\n// Remember which submit button was clicked (and its value)\nfunction _submitClick() {\n    var $button = $(this),\n        $form = $(this.form),\n        name = $button.attr('name'),\n        value = $button.attr('value');\n    if (name !== undefined && value !== undefined) {\n        $form.data('wq-submit-button-name', name);\n        $form.data('wq-submit-button-value', value);\n    }\n}\n\napp.getAuthState = function() {\n    return this.store.getState().auth || {};\n};\n\nfunction _authReducer(state = {}, action) {\n    if (!app.can_login) {\n        return state;\n    }\n    switch (action.type) {\n        case LOGIN_SUCCESS:\n        case LOGIN_RELOAD: {\n            const { user, config, csrftoken } = action.payload;\n            return { user, config, csrftoken };\n        }\n        case LOGOUT: {\n            const { csrftoken } = action.payload || {};\n            if (csrftoken) {\n                return { csrftoken };\n            } else {\n                return {};\n            }\n        }\n        case CSRFTOKEN: {\n            const { csrftoken } = action.payload;\n            return {\n                ...state,\n                csrftoken\n            };\n        }\n        default: {\n            return state;\n        }\n    }\n}\n\nfunction _checkLogin() {\n    setTimeout(function() {\n        ds.fetch('/login').then(function(result) {\n            if (result && result.user && result.config) {\n                ds.dispatch({\n                    type: LOGIN_RELOAD,\n                    payload: result\n                });\n            } else {\n                const { csrftoken } = result || {};\n                ds.dispatch({\n                    type: app.user ? LOGOUT : CSRFTOKEN,\n                    payload: {\n                        csrftoken\n                    }\n                });\n            }\n        });\n    }, 10);\n}\n\n// Add various callback functions to context object to automate foreign key\n// lookups within templates\nfunction _addLookups(page, context, editable) {\n    var conf = _getConf(page);\n    var lookups = {};\n\n    function addLookups(field, nested) {\n        var fname = nested || field.name;\n        // Choice (select/radio) lookups\n        if (field.choices) {\n            lookups[fname + '_label'] = _choice_label_lookup(\n                field.name,\n                field.choices\n            );\n            if (editable) {\n                lookups[fname + '_choices'] = _choice_dropdown_lookup(\n                    field.name,\n                    field.choices\n                );\n            }\n        }\n\n        // Foreign key lookups\n        if (field['wq:ForeignKey']) {\n            var nkey;\n            if (nested) {\n                nkey = fname.match(/^\\w+\\.(\\w+)\\[(\\w+)\\]$/);\n            } else {\n                nkey = fname.match(/^(\\w+)\\[(\\w+)\\]$/);\n            }\n            if (!nkey) {\n                if (nested) {\n                    lookups[fname] = _this_parent_lookup(field);\n                } else {\n                    lookups[fname] = _parent_lookup(field, context);\n                }\n                if (!context[fname + '_label']) {\n                    lookups[fname + '_label'] = _parent_label_lookup(field);\n                }\n            }\n            if (editable) {\n                lookups[fname + '_list'] = _parent_dropdown_lookup(\n                    field,\n                    context,\n                    nkey\n                );\n            }\n        }\n\n        // Load types/initial list of nested forms\n        // (i.e. repeats/attachments/EAV/child model)\n        if (field.children) {\n            field.children.forEach(function(child) {\n                var fname = field.name + '.' + child.name;\n                addLookups(child, fname);\n            });\n            if (editable == 'new' && !context[field.name]) {\n                lookups[field.name] = _default_attachments(field, context);\n            }\n        }\n    }\n    conf.form.forEach(function(field) {\n        addLookups(field, false);\n    });\n\n    // Process lookup functions\n    var keys = Object.keys(lookups);\n    var queue = keys.map(function(key) {\n        return lookups[key];\n    });\n    return Promise.all(queue)\n        .then(function(results) {\n            results.forEach(function(result, i) {\n                var key = keys[i];\n                context[key] = result;\n            });\n            results.forEach(function(result, i) {\n                var parts = keys[i].split('.'),\n                    nested;\n                if (parts.length != 2) {\n                    return;\n                }\n                nested = context[parts[0]];\n                if (!nested) {\n                    return;\n                }\n                if (!$.isArray(nested)) {\n                    nested = [nested];\n                }\n                nested.forEach(function(row) {\n                    row[parts[1]] = row[parts[1]] || result;\n                });\n            });\n        })\n        .then(function() {\n            return context;\n        });\n}\n\n// Preset list of choices\nfunction _choice_label_lookup(name, choices) {\n    function choiceLabel() {\n        if (!this[name]) {\n            return;\n        }\n        var label;\n        choices.forEach(function(choice) {\n            if (choice.name == this[name]) {\n                label = choice.label;\n            }\n        }, this);\n        return label;\n    }\n    return Promise.resolve(choiceLabel);\n}\n\nfunction _choice_dropdown_lookup(name, choices) {\n    choices = choices.map(function(choice) {\n        return { ...choice };\n    });\n    function choiceDropdown() {\n        choices.forEach(function(choice) {\n            if (choice.name == this[name]) {\n                choice.selected = true;\n            } else {\n                choice.selected = false;\n            }\n        }, this);\n        return choices;\n    }\n    return Promise.resolve(choiceDropdown);\n}\n\n// Simple foreign key lookup\nfunction _parent_lookup(field, context) {\n    var model = app.models[field['wq:ForeignKey']];\n    var id = context[field.name + '_id'];\n    if (id) {\n        if (id.match && id.match(/^outbox/)) {\n            return _getOutboxRecord(model, id);\n        } else {\n            return model.find(id);\n        }\n    } else {\n        return null;\n    }\n}\n\n// Foreign key lookup for objects other than root\nfunction _this_parent_lookup(field) {\n    var model = app.models[field['wq:ForeignKey']];\n    return Promise.all([_getOutboxRecordLookup(model), model.load()]).then(\n        function(results) {\n            const obRecords = results[0];\n            var existing = {};\n            results[1].list.forEach(item => {\n                existing[item.id] = item;\n            });\n            return function() {\n                var parentId = this[field.name + '_id'];\n                return obRecords[parentId] || existing[parentId];\n            };\n        }\n    );\n}\n\n// Foreign key label\nfunction _parent_label_lookup(field) {\n    return _this_parent_lookup(field).then(function(lookup) {\n        return function() {\n            var p = lookup.call(this);\n            return p && p.label;\n        };\n    });\n}\n\n// List of all potential foreign key values (useful for generating dropdowns)\nfunction _parent_dropdown_lookup(field, context, nkey) {\n    var model = app.models[field['wq:ForeignKey']];\n    var result;\n    if (field.filter) {\n        result = model.filter(_computeFilter(field.filter, context));\n    } else {\n        result = model.load().then(function(data) {\n            return _getOutboxRecords(model).then(function(records) {\n                return records.concat(data.list);\n            });\n        });\n    }\n    return result.then(function(choices) {\n        return function() {\n            var parents = [],\n                current;\n            if (nkey) {\n                current = this[nkey[1]] && this[nkey[1]][nkey[2]];\n            } else {\n                current = this[field.name + '_id'];\n            }\n            choices.forEach(function(v) {\n                var item = { ...v };\n                if (item.id == current) {\n                    item.selected = true; // Currently selected item\n                }\n                parents.push(item);\n            }, this);\n            return parents;\n        };\n    });\n}\n\nfunction _getOutboxRecords(model) {\n    return model.unsyncedItems().then(function(items) {\n        return items.map(function(item) {\n            return {\n                id: 'outbox-' + item.id,\n                label: item.label,\n                outbox_id: item.id,\n                outbox: true\n            };\n        });\n    });\n}\n\nfunction _getOutboxRecordLookup(model) {\n    return _getOutboxRecords(model).then(function(records) {\n        var lookup = {};\n        records.forEach(function(record) {\n            lookup[record.id] = record;\n        });\n        return lookup;\n    });\n}\n\nfunction _getOutboxRecord(model, id) {\n    return _getOutboxRecordLookup(model).then(function(records) {\n        return records[id];\n    });\n}\n\n// List of empty annotations for new objects\nfunction _default_attachments(field, context) {\n    if (field.type != 'repeat') {\n        return Promise.resolve({});\n    }\n    if (!field.initial) {\n        return Promise.resolve([]);\n    }\n    if (typeof field.initial == 'string' || typeof field.initial == 'number') {\n        var attachments = [];\n        for (var i = 0; i < +field.initial; i++) {\n            attachments.push({\n                '@index': i,\n                new_attachment: true\n            });\n        }\n        return Promise.resolve(attachments);\n    }\n    var typeField;\n    field.children.forEach(function(tf) {\n        if (tf.name == field.initial.type_field) {\n            typeField = tf;\n        }\n    });\n    if (!typeField) {\n        return Promise.resolve([]);\n    }\n\n    var model = app.models[typeField['wq:ForeignKey']];\n    var filterConf = field.initial.filter;\n    if (!filterConf || !Object.keys(filterConf).length) {\n        if (typeField.filter) {\n            filterConf = typeField.filter;\n        }\n    }\n    var filter = _computeFilter(filterConf, context);\n    return model.filter(filter).then(function(types) {\n        var attachments = [];\n        types.forEach(function(t, i) {\n            var obj = {\n                '@index': i,\n                new_attachment: true\n            };\n            obj[typeField.name + '_id'] = t.id;\n            obj[typeField.name + '_label'] = t.label;\n            attachments.push(obj);\n        });\n        return attachments;\n    });\n}\n\n// Load configuration based on page id\nfunction _getBaseConf(page) {\n    return _getConf(page, false, true);\n}\n\nfunction _getConf(page, silentFail, baseConf) {\n    var conf = (baseConf ? app.config : app.wq_config).pages[page];\n    if (!conf) {\n        if (silentFail) {\n            return;\n        } else {\n            throw new Error('Configuration for \"' + page + '\" not found!');\n        }\n    }\n    return {\n        page: page,\n        form: [],\n        modes: conf.list ? ['list', 'detail', 'edit'] : [],\n        ...conf\n    };\n}\n\n// Helper to load configuration based on URL\nfunction _getConfByUrl(url, silentFail) {\n    var parts = url.split('/');\n    var conf;\n    for (var p in app.wq_config.pages) {\n        if (app.wq_config.pages[p].url == parts[0]) {\n            conf = app.wq_config.pages[p];\n        }\n    }\n    if (!conf) {\n        if (silentFail) {\n            return;\n        } else {\n            throw 'Configuration for \"/' + url + '\" not found!';\n        }\n    }\n    return conf;\n}\n\nfunction _computeFilter(filter, context) {\n    var computedFilter = {};\n    Object.keys(filter).forEach(function(key) {\n        var values = filter[key];\n        if (!$.isArray(values)) {\n            values = [values];\n        }\n        values = values.map(function(value) {\n            if (value && value.indexOf && value.indexOf('{{') > -1) {\n                value = tmpl.render(value, context);\n                if (value === '') {\n                    return null;\n                } else if (value.match(/^\\+\\d+$/)) {\n                    return +value.substring(1);\n                }\n            }\n            return value;\n        });\n        if (values.length > 1) {\n            computedFilter[key] = values;\n        } else {\n            computedFilter[key] = values[0];\n        }\n    });\n    return computedFilter;\n}\n\nasync function _loadFromServer(url) {\n    // options = (ui && ui.options) || {};\n    if (app.config.debug) {\n        console.log('Loading ' + url + ' from server');\n        if (app.base_url && url.indexOf(app.base_url) !== 0) {\n            console.warn(url + ' does not include ' + app.base_url);\n        }\n    }\n    const response = await fetch(url),\n        html = await response.text();\n    return router.rawHTML(html);\n}\n\nfunction _serverContext(ctx) {\n    const { router_info: routeInfo } = ctx,\n        { full_path: url } = routeInfo;\n    return _loadFromServer(url);\n}\n\nfunction _fetchFail(query, error) {\n    /* eslint no-unused-vars: off */\n    app.spin.start('Error Loading Data', 1.5, {\n        theme: jqm.pageLoadErrorMessageTheme,\n        textonly: true\n    });\n}\n\nexport default app;\n"],"names":["app","OFFLINE","FAILURE","ERROR","wq_config","getAuthState","config","user","csrftoken","SERVER","LOGIN_SUCCESS","LOGIN_RELOAD","CSRFTOKEN","LOGOUT","models","plugins","_register","_onShow","$","jqm","init","jQuery","window","jQM","mobile","use","spinner","syncRefresh","showOutboxErrors","router","addContext","start","_getRouteInfo","userInfo","_getSyncInfo","addThunk","_refreshUserInfo","_refreshCSRFToken","base_url","getTemplateName","store","service","defaults","format","fetchFail","_fetchFail","ds","addReducer","_authReducer","Object","entries","forEach","name","plugin","ajax","reducer","state","action","render","addRender","actions","assign","bindActionCreators","thunks","addThunks","spin","msg","duration","opts","forSeconds","stop","outbox","debug","template","concat","keys","key","loadMissingAsJson","loadMissingAsHtml","backgroundSync","undefined","cordova","can_login","pages","login","tmpl","pause","console","warn","deprecated","noBackgroundSync","postsave","saveerror","_addOutboxItemsToContext","presync","postsync","hook","alternative","Error","hasPlugin","transitions","def","defaultPageTransition","dialog","defaultDialogTransition","maxTransitionWidth","maxwidth","page","callPlugins","root","conf","_getBaseConf","url","list","modes","mode","register","detail","onShow","server_modes","_serverContext","modelModule","_registerOther","_onShowOther","loadItems","runPlugins","_renderOutboxItem","index","templates","registerLast","ctx","context","map","document","on","_handleForm","_submitClick","router_info","ready","then","logout","setCSRFToken","_checkLogin","jqmInit","pcount","prefetchAll","Promise","all","prefetch","dispatch","type","fetch","result","payload","is_authenticated","app_config","csrf_token","getState","reload","unsynced","syncing","go","arg","routeInfo","getItem","outbox_id","resolve","item_id","local","find","item","MSApp","execUnsafeLocalFunction","activePage","sync","retryAll","emptyOutbox","confirmFirst","navigator","notification","confirm","button","empty","confirmSubmit","form","message","$form","data","trigger","postSaveNav","alreadySynced","pluginUrl","filter","length","postsaveurl","log","push","pconf","match","itemid","modelConf","options","deletedId","postdelete","_getConf","urlContext","deleted","indexOf","synced","id","error","reason","onsync","obitem","full_path","parent_id","outboxId","resultId","outboxSlug","replace","getParents","field","nav","replaceState","refresh","method","fn","args","fnArgs","queue","apply","_splitRoute","routeName","variant","split","_joinRoute","slugs","slug","pageid","svc","native","page_config","dom_id","_displayList","ppage","registerParent","parentContext","pitem","parentUrl","info","parent_url","parent_label","label","parent_page","unsyncedItems","parentInfo","getData","getUnsynced","pnum","model","client","filterPage","load","params","next","prev","_loadFromServer","server","unsynced1","data1","unsynced2","prevp","param","prevIsLocal","nextp","currentIsLocal","previous","multiple","previous_is_local","current_is_local","_addLookups","contextFn","_displayItem","_getDetailUrl","edit","registerFirst","localOnly","notFound","_displayOther","server_only","loadItem","idMatch","RegExp","evt","addVal","val","vals","isArray","isDefaultPrevented","prop","$submitVal","attr","append","storage","preserve","_getConfByUrl","$files","has_files","each","i","input","Blob","preventDefault","serializeArray","v","value","file","slice","files","webkitSlice","body","call","size","curVal","photos","_files","remove","_method","label_template","html","save","waitForItem","run","$page","is","parents","showError","errs","f","err","n","fid","non_field_errors","sel","$button","auth","setTimeout","editable","lookups","addLookups","nested","fname","choices","_choice_label_lookup","_choice_dropdown_lookup","nkey","_this_parent_lookup","_parent_lookup","_parent_label_lookup","_parent_dropdown_lookup","children","child","_default_attachments","results","parts","row","choiceLabel","choice","choiceDropdown","selected","_getOutboxRecord","_getOutboxRecordLookup","obRecords","existing","parentId","lookup","p","_computeFilter","_getOutboxRecords","records","current","items","record","initial","attachments","new_attachment","typeField","tf","type_field","filterConf","types","t","obj","silentFail","baseConf","computedFilter","values","substring","response","text","rawHTML","query","theme","pageLoadErrorMessageTheme","textonly"],"mappings":"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"}